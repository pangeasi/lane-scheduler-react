import{r as u,j as d}from"./storybook-Bou6zQpf.js";const $=u.createContext(null),W={height:80,slotWidth:60,slotColor:"#f3f4f6",slotBorderColor:"#e5e7eb",snapThreshold:.5},B=({laneId:o,appointments:h=[],blockedSlots:v=[],totalSlots:p=24,renderSlot:C,renderAppointmentContent:S,config:w={},onSlotDoubleClick:k,onSlotClick:E,onAppointmentChange:x})=>{const i={...W,...w},L=u.useRef(null),{dragState:a,setDragState:b,resizeState:s,setResizeState:g}=u.useContext($)||{},N=u.useCallback(e=>v.includes(e),[v]),R=u.useCallback(e=>{const t=L.current?.getBoundingClientRect();if(!t)return null;const n=e-t.left,r=Math.max(0,Math.floor(n/i.slotWidth));return r<p?r:null},[i.slotWidth,p]),O=u.useCallback((e,t)=>{const n=L.current?.getBoundingClientRect();return n?e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom:!1},[]),D=u.useCallback((e,t,n,r=null)=>{if(e<0||e+t>p)return!1;const m=r||h.find(l=>l.id===n);for(let l=e;l<e+t;l++)if(N(l))if(m?.onBlockedSlot){if(!m.onBlockedSlot(l,o))return!1}else return!1;return!0},[p,N,h,o]),I=u.useCallback((e,t,n)=>h.filter(r=>{if(r.id===n)return!1;const m=r.startSlot+r.duration,l=e+t;return!(m<=e||r.startSlot>=l)}),[h]),T=u.useCallback((e,t)=>{if(t.locked||!b)return;e.stopPropagation();const n="touches"in e?e.touches[0].clientX:e.clientX,r="touches"in e?e.touches[0].clientY:e.clientY;b({appointmentId:t.id,appointment:t,startX:n,startY:r,originalStartSlot:t.startSlot,currentStartSlot:t.startSlot,sourceLaneId:o,targetLaneId:o,isOverValidLane:!0})},[o,b]),z=u.useCallback((e,t)=>{if(!(!a||!b||a.sourceLaneId===o&&!O(e,t))&&O(e,t)){const n=R(e);if(n!==null){const r=a.appointment,f=!I(n,r.duration,r.id).some(()=>!r.allowOverlap)&&D(n,r.duration,r.id,r);b(y=>y?{...y,currentStartSlot:n,targetLaneId:o,isOverValidLane:f}:null)}}},[a,o,O,R,I,D,b]);u.useEffect(()=>{if(!a)return;const e=t=>{const n="touches"in t?t.touches[0].clientX:t.clientX,r="touches"in t?t.touches[0].clientY:t.clientY;z(n,r)};return window.addEventListener("mousemove",e),window.addEventListener("touchmove",e,{passive:!1}),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("touchmove",e)}},[a,z]);const j=u.useCallback((e,t,n)=>{if(t.locked||!g)return;e.stopPropagation();const r="touches"in e?e.touches[0].clientX:e.clientX;g({appointmentId:t.id,laneId:o,edge:n,startX:r,originalStartSlot:t.startSlot,originalDuration:t.duration,currentStartSlot:t.startSlot,currentDuration:t.duration})},[o,g]),X=u.useCallback(e=>{if(!s||!g||s.laneId!==o)return;const n=("touches"in e?e.touches[0].clientX:e.clientX)-s.startX,r=Math.round(n/i.slotWidth);let m=s.originalStartSlot,l=s.originalDuration;if(s.edge==="start"?(m=Math.max(0,s.originalStartSlot+r),l=s.originalDuration-r):l=Math.max(1,s.originalDuration+r),l<1)return;const f=h.find(c=>c.id===s.appointmentId);if(!f)return;!I(m,l,f.id).some(()=>!f.allowOverlap)&&D(m,l,f.id)&&g(c=>c?{...c,currentStartSlot:m,currentDuration:l}:null)},[s,o,i.slotWidth,h,I,D,g]),A=u.useCallback(()=>{if(!s||s.laneId!==o||!g)return;const e=h.find(n=>n.id===s.appointmentId);if(!e)return;(s.currentStartSlot!==s.originalStartSlot||s.currentDuration!==s.originalDuration)&&x?.({...e,startSlot:s.currentStartSlot,duration:s.currentDuration}),g(null)},[s,o,h,x,g]);u.useEffect(()=>{if(s&&s.laneId===o){const e=n=>X(n),t=()=>A();return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),window.addEventListener("touchmove",e),window.addEventListener("touchend",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t),window.removeEventListener("touchmove",e),window.removeEventListener("touchend",t)}}},[s,o,X,A]);const q=e=>{const t=a?.appointmentId===e.id&&a?.sourceLaneId===o,n=a?.appointmentId===e.id&&a?.targetLaneId===o,r=s?.appointmentId===e.id&&s?.laneId===o;let m=e.startSlot,l=e.duration,f=1;t&&(f=.3),n&&a.targetLaneId===o?(m=a.currentStartSlot,f=a.isOverValidLane?.7:.3):r&&(m=s.currentStartSlot,l=s.currentDuration,f=.7);const y=m*i.slotWidth,V=l*i.slotWidth;return n&&a.sourceLaneId!==o&&a.targetLaneId!==o?null:d.jsx("div",{className:"absolute top-0",style:{left:`${y}px`,width:`${V}px`,height:`${i.height}px`,opacity:f,transition:t||r?"none":"all 0.2s ease",touchAction:"none",zIndex:t?1e3:1},children:d.jsxs("div",{className:`h-full ${a?.isOverValidLane===!1&&n?"bg-red-500":"bg-blue-500"} text-white rounded shadow-md flex items-center justify-center relative overflow-hidden ${e.locked?"cursor-not-allowed":"cursor-move"}`,onMouseDown:c=>T(c,e),onTouchStart:c=>T(c,e),children:[!e.locked&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-blue-700 z-10",onMouseDown:c=>j(c,e,"start"),onTouchStart:c=>j(c,e,"start")}),d.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-blue-700 z-10",onMouseDown:c=>j(c,e,"end"),onTouchStart:c=>j(c,e,"end")})]}),d.jsx("div",{className:"px-2 text-sm truncate pointer-events-none",children:S?S(e):e.title||`Apt ${e.id}`}),e.locked&&d.jsx("div",{className:"absolute top-1 right-1",children:d.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})})})]})},e.id)},M=a&&a.sourceLaneId!==o&&a.targetLaneId===o;return d.jsxs("div",{ref:L,className:"relative select-none",style:{height:`${i.height}px`,width:`${p*i.slotWidth}px`},children:[Array.from({length:p}).map((e,t)=>{const n=N(t);return d.jsx("div",{className:"absolute top-0 bottom-0 border-r",style:{left:`${t*i.slotWidth}px`,width:`${i.slotWidth}px`,backgroundColor:n?"#fee2e2":i.slotColor,borderColor:i.slotBorderColor},onClick:()=>E?.(t,o),onDoubleClick:()=>k?.(t,o),children:C?C(t,n):d.jsx("div",{className:"flex items-center justify-center h-full text-xs text-gray-400",children:t})},t)}),h.map(q),M&&a&&d.jsx("div",{className:"absolute top-0",style:{left:`${a.currentStartSlot*i.slotWidth}px`,width:`${a.appointment.duration*i.slotWidth}px`,height:`${i.height}px`,opacity:a.isOverValidLane?.7:.3,zIndex:999},children:d.jsx("div",{className:`h-full ${a.isOverValidLane?"bg-blue-500":"bg-red-500"} text-white rounded shadow-md flex items-center justify-center`,children:d.jsx("div",{className:"px-2 text-sm truncate pointer-events-none",children:S?S(a.appointment):a.appointment.title||`Apt ${a.appointment.id}`})})})]})};B.__docgenInfo={description:"",methods:[],displayName:"Lane",props:{laneId:{required:!0,tsType:{name:"string"},description:""},appointments:{required:!1,tsType:{name:"Array",elements:[{name:"Appointment"}],raw:"Appointment[]"},description:"",defaultValue:{value:"[]",computed:!1}},blockedSlots:{required:!1,tsType:{name:"Array",elements:[{name:"number"}],raw:"number[]"},description:"",defaultValue:{value:"[]",computed:!1}},totalSlots:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"24",computed:!1}},renderSlot:{required:!1,tsType:{name:"signature",type:"function",raw:"(slotIndex: number, isBlocked: boolean) => ReactNode",signature:{arguments:[{type:{name:"number"},name:"slotIndex"},{type:{name:"boolean"},name:"isBlocked"}],return:{name:"ReactNode"}}},description:""},renderAppointmentContent:{required:!1,tsType:{name:"signature",type:"function",raw:"(appointment: Appointment) => ReactNode",signature:{arguments:[{type:{name:"Appointment"},name:"appointment"}],return:{name:"ReactNode"}}},description:""},config:{required:!1,tsType:{name:"LaneConfig"},description:"",defaultValue:{value:"{}",computed:!1}},onSlotDoubleClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(slotIndex: number, laneId: string) => void",signature:{arguments:[{type:{name:"number"},name:"slotIndex"},{type:{name:"string"},name:"laneId"}],return:{name:"void"}}},description:""},onSlotClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(slotIndex: number, laneId: string) => void",signature:{arguments:[{type:{name:"number"},name:"slotIndex"},{type:{name:"string"},name:"laneId"}],return:{name:"void"}}},description:""},onAppointmentChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(appointment: Appointment) => void",signature:{arguments:[{type:{name:"Appointment"},name:"appointment"}],return:{name:"void"}}},description:""}}};const P=({children:o,onAppointmentMove:h})=>{const[v,p]=u.useState(null),[C,S]=u.useState(null),w=u.useCallback(()=>{if(!v)return;const{appointment:k,sourceLaneId:E,targetLaneId:x,currentStartSlot:i,isOverValidLane:L}=v;L&&(E!==x||i!==k.startSlot)&&h?.(k,E,x,i),p(null)},[v,h]);return u.useEffect(()=>{if(v)return window.addEventListener("mouseup",w),window.addEventListener("touchend",w),()=>{window.removeEventListener("mouseup",w),window.removeEventListener("touchend",w)}},[v,w]),d.jsx($.Provider,{value:{dragState:v,setDragState:p,resizeState:C,setResizeState:S},children:o})};P.__docgenInfo={description:"",methods:[],displayName:"Scheduler",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},onAppointmentMove:{required:!1,tsType:{name:"signature",type:"function",raw:`(
  appointment: Appointment,
  sourceLaneId: string,
  targetLaneId: string,
  newStartSlot: number
) => void`,signature:{arguments:[{type:{name:"Appointment"},name:"appointment"},{type:{name:"string"},name:"sourceLaneId"},{type:{name:"string"},name:"targetLaneId"},{type:{name:"number"},name:"newStartSlot"}],return:{name:"void"}}},description:""}}};export{B as L,P as S};
